%% 
clear all;clc;close all;
addpath('D:\software\fieldtrip-20190325');
% addpath('D:\software\eeglab14_1_2b');
%%  [event label, timepoint index] 
% 32769: music starts; 32770: music is over
temp_1216 = [32769.0,54380.0
32769.0,80515.0
32769.0,103172.0
32769.0,133016.0
32769.0,357148.0
32769.0,369367.0
32769.0,431960.0
32769.0,495353.0
32769.0,548445.0
32769.0,607235.0
32769.0,620230.0
32769.0,696149.0
32769.0,718078.0
32769.0,737202.0
32769.0,765370.0
32769.0,789894.0
32769.0,818347.0
32769.0,853232.0
32769.0,879933.0
32769.0,915464.0
32769.0,949432.0
32769.0,981101.0
32769.0,1013238.0
32769.0,1050882.0
32769.0,1079786.0
32769.0,1105217.0
32769.0,1147861.0
32769.0,1175535.0
32769.0,1205876.0
32769.0,1217053.0
32769.0,1278944.0
32769.0,1307450.0
32769.0,1338393.0
32769.0,1378846.0
32769.0,1413091.0
32769.0,1452522.0
32769.0,1481033.0
32769.0,1508657.0
32769.0,1530327.0
32769.0,1559678.0
32769.0,1587945.0 
32769.0,1614411.0 
32769.0,1679684.0
32769.0,1706353.0
32769.0,1730366.0
32769.0,1769992.0
32769.0,1789427.0
32769.0,1850898.0
32769.0,1866437.0
32769.0,1909251.0
32769.0,1943249.0
32769.0,1958579.0
32769.0,2001012.0
32769.0,2043849.0
32769.0,2083099.0
32769.0,2103793.0
32769.0,2131542.0
32769.0,2160132.0
32769.0,2201813.0
32769.0,2233322.0
32769.0,2257948.0
32769.0,2282801.0
32769.0,2344235.0
32769.0,2377629.0
32769.0,2401483.0
32769.0,2422395.0
32769.0,2470270.0
32769.0,2499223.0
32769.0,2611067.0  
32769.0,2642659.0
32769.0,2682648.0
32769.0,2705037.0
];

temp_1158 = [32769.0,139040.0
32769.0,153288.0
32769.0,180804.0
32769.0,202198.0
32769.0,233079.0
32769.0,300262.0
32769.0,340597.0
32769.0,391796.0
32769.0,400819.0
32769.0,434872.0
32769.0,464543.0
32769.0,479973.0
32769.0,532319.0
32769.0,829213.0
32769.0,896077.0
32769.0,929582.0
32769.0,952608.0
32769.0,1025722.0
32769.0,1056437.0
32769.0,1090925.0
32769.0,1137126.0
32769.0,1161203.0
32769.0,1210043.0
];
%% 
cfg            = [];
cfg.dataset    = 'data/record-[2019.04.09-11.58.18]-8000.gdf';
cfg.continuous = 'yes';
cfg.channel    = 'all';
sample_data   = ft_preprocessing(cfg);
%% 
data1= ft_read_data('data/record-[2019.04.09-12.16.56]-8000.gdf');
data2 = ft_read_data('data/record-[2019.04.09-11.58.18]-8000.gdf');
%% time-locked from -2s to 2s to event  
trailSize = length(temp_1216);
for i_1216=1:trailSize
    person2_2(:,:,i_1216) = data1(:,[temp_1216(i_1216,2)-2*2048:temp_1216(i_1216,2)]);
end

for i_1216=1:trailSize
    person2_2(:,:,i_1216+trailSize) = data1(:,[temp_1216(i_1216,2)-1*2048:temp_1216(i_1216,2)+1*2048]);
end

for i_1216=1:trailSize
    person2_2(:,:,i_1216+trailSize*2) = data1(:,[temp_1216(i_1216,2):temp_1216(i_1216,2)+2*2048]);
end

% trial2
trailSize = length(temp_1158);
for i_1158=1:length(temp_1158)
    person2_2(:,:,i_1158+i_1216*3) = data1(:,[temp_1158(i_1158,2)-2*2048:temp_1158(i_1158,2)]);
end

for i_1158=1:length(temp_1158)
    person2_2(:,:,i_1158+i_1216*3+trailSize) = data1(:,[temp_1158(i_1158,2)-1*2048:temp_1158(i_1158,2)+1*2048]);
end

for i_1158=1:length(temp_1158)
    person2_2(:,:,i_1158+i_1216*3+trailSize*2) = data1(:,[temp_1158(i_1158,2):temp_1158(i_1158,2)+2*2048]);
end
%%
cfg = []; data = [];
interval = 1/sample_data.fsample;

[~,timePoints,trilNum ] = size(person2_2);
if timePoints ~= 0
    interval = 1/sample_data.fsample;
    for i = 1:trilNum
        data.trial{1,i} = person2_2(:,:,i);
        data.time{i,1} = 0:interval:interval * (timePoints-1);
    end
    data.label = sample_data.label;
    data.fsample = sample_data.fsample;
    [person2_2] = ft_preprocessing (cfg, data);
end
%%
save eeglab/person2_2.mat person2_2
%% change fieldtrip format into EEGLab set format, save into data/eeglab directory 
fieldtrip2eeglab_min(person2_2);